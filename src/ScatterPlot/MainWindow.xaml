<Window x:Class="ScatterPlotExplorer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ScottPlot="clr-namespace:ScottPlot.WPF;assembly=ScottPlot.WPF"
        mc:Ignorable="d"
        Title="Scatter Plot Explorer" Height="750" Width="1150"
        MinWidth="800" MinHeight="600"
        AllowDrop="True" Drop="Window_Drop" DragOver="Window_DragOver">
    <DockPanel>
        <!-- Menu bar -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File">
                <MenuItem Header="_Open..." Click="BtnOpen_Click" InputGestureText="Ctrl+O"/>
                <MenuItem Header="_Close File" Click="BtnClose_Click" x:Name="menuClose" IsEnabled="False"/>
                <MenuItem Header="_New Window" Click="MenuNewWindow_Click" InputGestureText="Linked view"/>
                <Separator/>
                <MenuItem Header="_Recent Files" x:Name="menuRecent">
                    <MenuItem Header="(none)" IsEnabled="False"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="E_xit" Click="MenuExit_Click" InputGestureText="Alt+F4"/>
            </MenuItem>
            <MenuItem Header="_Export">
                <MenuItem Header="_Copy selected" Click="MenuCopySelected_Click" InputGestureText="Ctrl+C"
                          x:Name="menuCopySelected" IsEnabled="False"/>
                <MenuItem Header="Copy _R Code" Click="MenuCopyRCode_Click"
                          x:Name="menuCopyRCode" IsEnabled="False"/>
            </MenuItem>
            <MenuItem Header="_Journal">
                <MenuItem Header="_Publish / Append view..." Click="MenuJournalPublish_Click"
                          x:Name="menuJournalPublish" IsEnabled="False"/>
                <MenuItem Header="_Edit journal..." Click="MenuJournalEdit_Click"
                          x:Name="menuJournalEdit"/>
                <Separator/>
                <MenuItem Header="_Open in browser" Click="MenuJournalOpen_Click"
                          x:Name="menuJournalOpen"/>
                <MenuItem Header="_Load view from journal..." Click="MenuJournalLoad_Click"
                          x:Name="menuJournalLoad"/>
            </MenuItem>
        </Menu>

        <Grid Margin="6">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="280"/>
            </Grid.ColumnDefinitions>

            <!-- ===== Main area (left) ===== -->
            <Grid Grid.Column="0" Margin="0,0,6,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="200"/>
                </Grid.RowDefinitions>

                <!-- File open -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,4">
                    <Button x:Name="btnOpen" Content="Open File..." Click="BtnOpen_Click"
                            Padding="12,4" FontSize="13"/>
                    <Button x:Name="btnClose" Content="Close File" Click="BtnClose_Click"
                            Padding="12,4" FontSize="13" Margin="6,0,0,0" IsEnabled="False"/>
                    <TextBlock x:Name="txtFileName" VerticalAlignment="Center"
                               Margin="10,0,0,0" Foreground="Gray" Text="Drag &amp; drop a delimited text file, or click Open"/>
                </StackPanel>

            <!-- ScottPlot + selection overlay + hover tooltip -->
            <Grid Grid.Row="1">
                <ScottPlot:WpfPlot x:Name="wpfPlot"/>
                <Canvas x:Name="selectionCanvas" IsHitTestVisible="False">
                    <Rectangle x:Name="selectionRect" Visibility="Collapsed"
                               Stroke="#2277DD" StrokeThickness="1.5"
                               Fill="#221F77B4" StrokeDashArray="4 2"/>
                </Canvas>
                <!-- Hover tooltip -->
                <Border x:Name="hoverTooltip" Visibility="Collapsed" IsHitTestVisible="False"
                        Background="#EE333333" CornerRadius="4" Padding="8,4"
                        HorizontalAlignment="Left" VerticalAlignment="Top"
                        MaxWidth="350">
                    <TextBlock x:Name="hoverTooltipText" Foreground="White" FontSize="11"
                               TextWrapping="Wrap"/>
                </Border>
            </Grid>

            <!-- Selection header + copy button -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,6,0,2">
                <TextBlock Text="Selected Points" FontWeight="SemiBold" FontSize="13"
                           VerticalAlignment="Center"/>
                <TextBlock x:Name="txtSelCount" Margin="8,0,0,0" Foreground="Gray"
                           VerticalAlignment="Center"/>
                <Button x:Name="btnCopy" Content="Copy to Clipboard" Click="BtnCopy_Click"
                        Margin="16,0,0,0" Padding="10,3" IsEnabled="False"/>
            </StackPanel>

            <!-- Data grid for selected rows -->
            <DataGrid x:Name="dgSelected" Grid.Row="3"
                      IsReadOnly="True" AutoGenerateColumns="True"
                      HeadersVisibility="Column" CanUserSortColumns="True"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Auto"
                      SelectionMode="Extended" SelectionUnit="FullRow"
                      SelectionChanged="DgSelected_SelectionChanged"
                      Sorting="DgSelected_Sorting"
                      AutoGeneratingColumn="DgSelected_AutoGeneratingColumn"
                      FontSize="12">
                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Copy selected" Click="MenuCopySelected_Click"/>
                    </ContextMenu>
                </DataGrid.ContextMenu>
            </DataGrid>
        </Grid>

        <!-- ===== Sidebar (right) ===== -->
        <Border Grid.Column="1" BorderBrush="#DDD" BorderThickness="1" CornerRadius="4"
                Padding="10" Background="#FAFAFA">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel x:Name="panelControls" IsEnabled="False">

                    <TextBlock Text="Axes" FontWeight="Bold" FontSize="13" Margin="0,0,0,4"/>
                    <TextBlock Text="X axis" FontSize="11" Foreground="Gray"/>
                    <ComboBox x:Name="cboX" SelectionChanged="Axis_Changed" Margin="0,0,0,6"/>
                    <TextBlock Text="Y axis" FontSize="11" Foreground="Gray"/>
                    <ComboBox x:Name="cboY" SelectionChanged="Axis_Changed" Margin="0,0,0,6"/>

                    <Separator Margin="0,4"/>

                    <TextBlock Text="Colour" FontWeight="Bold" FontSize="13" Margin="0,6,0,4"/>
                    <TextBlock Text="Colour by column" FontSize="11" Foreground="Gray"/>
                    <ComboBox x:Name="cboColor" SelectionChanged="Appearance_Changed" Margin="0,0,0,4"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                        <CheckBox x:Name="chkLogColor" Content="Log10" Margin="0,0,10,0"
                                  FontSize="11" Checked="Appearance_Changed" Unchecked="Appearance_Changed"/>
                        <CheckBox x:Name="chkReverseColor" Content="Reverse"
                                  FontSize="11" Checked="Appearance_Changed" Unchecked="Appearance_Changed"/>
                    </StackPanel>

                    <TextBlock Text="Single colour" FontSize="11" Foreground="Gray"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                        <Rectangle x:Name="rectColor" Width="24" Height="24"
                                   Stroke="#999" StrokeThickness="1" RadiusX="3" RadiusY="3"
                                   Fill="#1F77B4" Cursor="Hand"
                                   MouseLeftButtonUp="RectColor_Click"/>
                        <ComboBox x:Name="cboPresetColor" Width="140" Margin="6,0,0,0"
                                  SelectionChanged="PresetColor_Changed"/>
                    </StackPanel>
                    <CheckBox x:Name="chkColorSelected" Content="Colour selected"
                              FontSize="11" Margin="0,0,0,6"
                              ToolTip="When checked, changing the colour above applies permanently to selected points"/>

                    <Separator Margin="0,4"/>

                    <TextBlock Text="Symbol" FontWeight="Bold" FontSize="13" Margin="0,6,0,4"/>
                    <TextBlock Text="Shape by column" FontSize="11" Foreground="Gray"/>
                    <ComboBox x:Name="cboShapeCol" SelectionChanged="Appearance_Changed" Margin="0,0,0,6"/>
                    <TextBlock Text="Single shape" FontSize="11" Foreground="Gray"/>
                    <ComboBox x:Name="cboShape" SelectionChanged="Appearance_Changed" Margin="0,0,0,6"/>

                    <TextBlock Text="Label by column" FontSize="11" Foreground="Gray"/>
                    <ComboBox x:Name="cboLabelCol" SelectionChanged="Appearance_Changed" Margin="0,0,0,4"/>
                    <Button x:Name="btnLabelFont" Content="Font properties..." Click="BtnLabelFont_Click"
                            Padding="6,2" FontSize="11" HorizontalAlignment="Left" Margin="0,0,0,6"/>

                    <TextBlock Text="Size by column" FontSize="11" Foreground="Gray"/>
                    <ComboBox x:Name="cboSizeCol" SelectionChanged="Appearance_Changed" Margin="0,0,0,4"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                        <CheckBox x:Name="chkLogSize" Content="Log10" Margin="0,0,10,0"
                                  FontSize="11" Checked="Appearance_Changed" Unchecked="Appearance_Changed"/>
                        <CheckBox x:Name="chkReverseSize" Content="Reverse"
                                  FontSize="11" Checked="Appearance_Changed" Unchecked="Appearance_Changed"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                        <TextBlock Text="Single size" FontSize="11" Foreground="Gray" VerticalAlignment="Center"/>
                        <Slider x:Name="sliderSize" Minimum="2" Maximum="30" Value="8"
                                Width="130" Margin="6,0,0,0"
                                TickFrequency="1" IsSnapToTickEnabled="True"
                                ValueChanged="Appearance_Changed"/>
                        <TextBlock Text="{Binding Value, ElementName=sliderSize, StringFormat={}{0:0}}"
                                   Margin="4,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>

                    <Separator Margin="0,4"/>

                    <TextBlock Text="Scale" FontWeight="Bold" FontSize="13" Margin="0,6,0,4"/>
                    <CheckBox x:Name="chkLogX" Content="Log10 X axis" Margin="0,0,0,4"
                              Checked="LogScale_Changed" Unchecked="LogScale_Changed"/>
                    <CheckBox x:Name="chkLogY" Content="Log10 Y axis" Margin="0,0,0,4"
                              Checked="LogScale_Changed" Unchecked="LogScale_Changed"/>
                    <CheckBox x:Name="chkInvertX" Content="Invert X axis" Margin="0,0,0,4"
                              Checked="InvertAxis_Changed" Unchecked="InvertAxis_Changed"/>
                    <CheckBox x:Name="chkInvertY" Content="Invert Y axis" Margin="0,0,0,6"
                              Checked="InvertAxis_Changed" Unchecked="InvertAxis_Changed"/>

                    <TextBlock Text="Axis Ranges" FontWeight="Bold" FontSize="13" Margin="0,6,0,4"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="X min" FontSize="11" Foreground="Gray"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="X max" FontSize="11" Foreground="Gray" Margin="4,0,0,0"/>
                        <TextBox x:Name="txtXMin" Grid.Row="1" Grid.Column="0" Margin="0,0,2,6"
                                 LostFocus="AxisRange_Changed"/>
                        <TextBox x:Name="txtXMax" Grid.Row="1" Grid.Column="1" Margin="2,0,0,6"
                                 LostFocus="AxisRange_Changed"/>
                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Y min" FontSize="11" Foreground="Gray"/>
                        <TextBlock Grid.Row="2" Grid.Column="1" Text="Y max" FontSize="11" Foreground="Gray" Margin="4,0,0,0"/>
                        <TextBox x:Name="txtYMin" Grid.Row="3" Grid.Column="0" Margin="0,0,2,6"
                                 LostFocus="AxisRange_Changed"/>
                        <TextBox x:Name="txtYMax" Grid.Row="3" Grid.Column="1" Margin="2,0,0,6"
                                 LostFocus="AxisRange_Changed"/>
                    </Grid>

                    <Separator Margin="0,4"/>

                    <TextBlock Text="Legend" FontWeight="Bold" FontSize="13" Margin="0,6,0,4"/>
                    <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto">
                        <StackPanel x:Name="legendPanel"/>
                    </ScrollViewer>

                    <Separator x:Name="filterSeparator" Margin="0,4"/>

                    <TextBlock x:Name="filterHeader" Text="Filters" FontWeight="Bold" FontSize="13" Margin="0,6,0,4"/>
                    <StackPanel x:Name="filterPanel"/>

                    <Separator Margin="0,4"/>

                    <TextBlock Text="Statistics" FontWeight="Bold" FontSize="13" Margin="0,6,0,4"/>
                    <StackPanel x:Name="statsPanel">
                        <TextBlock Text="(no model fitted)" FontSize="11" Foreground="Gray"/>
                    </StackPanel>

                    <Separator Margin="0,4"/>

                    <TextBlock Text="Search" FontWeight="Bold" FontSize="13" Margin="0,6,0,4"/>
                    <TextBox x:Name="txtSearch" Margin="0,0,0,4" FontSize="12"
                             KeyDown="TxtSearch_KeyDown"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                        <Button x:Name="btnSearch" Content="Select" Click="BtnSearch_Click"
                                Padding="8,3"/>
                        <TextBlock x:Name="txtSearchResult" Margin="8,0,0,0" FontSize="11"
                                   VerticalAlignment="Center" Foreground="Gray"/>
                    </StackPanel>
                    <TextBlock Text="e.g. setosa, age > 50, name contains Jo"
                               FontSize="10" Foreground="#999" TextWrapping="Wrap" Margin="0,0,0,4"/>

                    <Separator Margin="0,4"/>

                    <TextBlock Text="Selection" FontWeight="Bold" FontSize="13" Margin="0,6,0,4"/>
                    <TextBlock Text="Left-drag to select, right-drag to pan&#x0a;Drag on axis to zoom, scroll to zoom&#x0a;Hover/click legend to highlight" FontSize="11" Foreground="Gray"
                               TextWrapping="Wrap" Margin="0,0,0,4"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                        <Button Content="Clear Selection" Click="BtnClearSelection_Click"
                                Padding="8,3"/>
                        <Button Content="Reset Zoom" Click="BtnResetZoom_Click"
                                Padding="8,3" Margin="8,0,0,0"/>
                    </StackPanel>
                    <Button Content="Fit Linear Model..." Click="BtnFitModel_Click"
                            Padding="8,3" Margin="0,4,0,0"/>
                </StackPanel>
            </ScrollViewer>
        </Border>
        </Grid>
    </DockPanel>
</Window>
